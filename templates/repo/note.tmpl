{{with .ColumnNote}}
{{$backendURL := (print $.root.FeedURL "/projects/" .ProjectID "/" .BoardID "/note/")}}
{{if not $.root.Repository}}
	{{$backendURL = (print $.root.FeedURL "/-/projects/" .ProjectID "/" .BoardID "/note/")}}
{{end}}
<div class="content gt-p-0 gt-w-full">
	<div class="gt-df gt-items-start">
		<div class="project-column-note-card-icon">
			{{svg "octicon-note"}}
		</div>
		<span class="note-card-title muted project-column-note-title">{{.Title}}</span>
		{{if or $.CanWriteProjects (gt (len .Content) 0)}}
			<div class="ui dropdown jump item">
				<div class="gt-px-3">
					{{svg "octicon-kebab-horizontal"}}
				</div>
				<div class="menu user-menu left">
					<button class="ui item show-modal button"
						data-modal="#view-project-column-note-modal-{{.ID}}">
							{{svg "octicon-eye"}}
							{{ctx.Locale.Tr "repo.projects.note.view"}}
					</button>
					{{if $.CanWriteProjects}}
						{{if eq $.root.Context.Doer.ID .CreatorID}}
							<button class="ui item show-modal button"
								data-modal="#edit-project-column-note-modal-{{.ID}}"
								data-modal-form.action="{{$backendURL}}{{.ID}}">
									{{svg "octicon-pencil"}}
									{{ctx.Locale.Tr "repo.projects.note.edit"}}
							</button>
						{{end}}
						{{if $.root.Repository}}
							<a class="ui item button create-project-issue-from-note" href="{{$.root.FeedURL}}/issues/new/choose?project={{$.root.Project.ID}}">
								{{svg "octicon-issue-opened"}}
								{{ctx.Locale.Tr "repo.issues.new"}}
							</a>
						{{end}}
						{{$notPinnedAndNotAllowedToPin := and (not .IsPinned) (not (.IsNewPinAllowed ctx)) (or $.root.Context.Doer.IsAdmin (eq $.root.Context.Doer.ID .CreatorID))}}
						<button class="ui item button {{if $notPinnedAndNotAllowedToPin}}disabled{{end}} pin-project-column-note"
							{{if $notPinnedAndNotAllowedToPin}}style="pointer-events: unset !important"{{end}}
							data-method="{{if .IsPinned}}delete{{else}}post{{end}}"
							data-url="{{$backendURL}}{{.ID}}/pin"
							{{if $notPinnedAndNotAllowedToPin}}data-tooltip-content="{{ctx.Locale.Tr "repo.projects.note.max_pinned"}}"{{end}}>
								{{if .IsPinned}}
									{{svg "octicon-pin-slash"}}
									{{ctx.Locale.Tr "unpin"}}
								{{else}}
									{{svg "octicon-pin"}}
									{{ctx.Locale.Tr "pin"}}
								{{end}}
						</button>
						{{if eq $.root.Context.Doer.ID .CreatorID}}
							<button class="ui item show-modal button"
								data-modal="#delete-project-column-note-modal-{{.ID}}"
								data-modal-form.action="{{$backendURL}}{{.ID}}">
									{{svg "octicon-trash"}}
									{{ctx.Locale.Tr "repo.projects.note.delete"}}
							</button>
						{{end}}
					{{end}}

					<div class="ui modal" id="view-project-column-note-modal-{{.ID}}">
						<div class="header">
							{{ctx.Locale.Tr "repo.projects.note.view"}}
						</div>
						<div class="content ui form">
							<div class="field">
								<label class="gt-font-16">{{ctx.Locale.Tr "repo.projects.note.title"}}</label>
								{{.Title}}
							</div>

							{{if and $.root.Labels (gt (len $.root.Labels) 0)}}
								<div class="field">
									<label class="gt-font-16">{{ctx.Locale.Tr "repo.projects.note.labels"}}</label>
									{{if .LabelIDs}}
										{{RenderLabelsFromIDs ctx .LabelIDs $.root.FeedURL}}
									{{else}}
										{{ctx.Locale.Tr "repo.projects.note.no_label"}}
									{{end}}
								</div>
							{{end}}

							{{if or $.root.OpenMilestones $.root.ClosedMilestones}}
								<div class="field">
									<label class="gt-font-16">{{ctx.Locale.Tr "repo.projects.note.milestone"}}</label>
									{{if .MilestoneID}}
										{{RenderMilestone ctx .MilestoneID $.root.Repository.ID}}
									{{else}}
										{{ctx.Locale.Tr "repo.projects.note.no_milestone"}}
									{{end}}
								</div>
							{{end}}

							<div class="field">
								<label class="gt-font-16">{{ctx.Locale.Tr "repo.projects.note.description"}}</label>
								{{RenderMarkdownToHtml ctx .Content}}
							</div>
						</div>
						<div class="actions">
							<button class="ui cancel button">{{ctx.Locale.Tr "repo.projects.close"}}</button>
						</div>
					</div>

					{{if and $.RenderModals $.CanWriteProjects}}
						<div class="ui modal" id="edit-project-column-note-modal-{{.ID}}">
							<div class="header">
								{{ctx.Locale.Tr "repo.projects.note.edit"}}
							</div>
							<form class="ui form form-fetch-action" method="put">
								<div class="content">
									{{$.root.CsrfTokenHtml}}
									<div class="required field">
										<label for="edit-project-column-note-title-{{.ID}}">{{ctx.Locale.Tr "repo.projects.note.title"}}</label>
										<input id="edit-project-column-note-title-{{.ID}}" name="title" value="{{.Title}}" maxlength="255" autofocus required>
									</div>

									{{if and $.root.Labels (gt (len $.root.Labels) 0)}}
										<div class="field">
											<label for="edit-project-column-note-label-{{.ID}}">{{ctx.Locale.Tr "repo.projects.note.labels"}}</label>
											<div class="ui fluid selection search normal dropdown multiple clearable">
												<input type="hidden" id="edit-project-column-note-label-{{.ID}}" name="labelIds" value="{{range $index, $val := .LabelIDs}}{{if ne $index 0}},{{end}}{{$val}}{{end}}">
												{{svg "octicon-triangle-down" 14 "dropdown icon"}}
												<div class="default text"></div>
												<div class="menu">
													{{range $.root.Labels}}
														<div class="item vertical gt-gap-y-2" data-value="{{.ID}}">
															<small class="desc">{{.Description | RenderEmoji ctx}}</small>
															<span>{{RenderLabel ctx .}}</span>
														</div>
													{{end}}
												</div>
											</div>
										</div>
									{{end}}

									{{if or $.root.OpenMilestones $.root.ClosedMilestones}}
										<div class="field">
											<label for="edit-project-column-note-milestone-{{.ID}}">{{ctx.Locale.Tr "repo.projects.note.milestone"}}</label>
											{{template "projects/milestone_selection" (dict "." $.root "MilestoneID" .MilestoneID)}}
										</div>
									{{end}}

									<div class="field">
										{{template "shared/combomarkdowneditor" (dict
											"MarkdownPreviewUrl" (print $.root.FeedURL "/markup")
											"MarkdownPreviewContext" $.root.FeedURL
											"TextareaName" "content"
											"TextareaContent" .Content
											"TextareaPlaceholder" (ctx.Locale.Tr "repo.projects.note.description")
										)}}
									</div>
								</div>

								{{template "base/modal_actions_confirm" (dict "ModalButtonTypes" "confirm" "ModalButtonOkText" (ctx.Locale.Tr "repo.projects.note.edit"))}}
							</form>
						</div>

						<div class="ui g-modal-confirm modal" id="delete-project-column-note-modal-{{.ID}}">
							<div class="header">
								{{ctx.Locale.Tr "repo.projects.note.delete"}}
							</div>
							<form class="ui form form-fetch-action" method="delete">
								{{$.root.CsrfTokenHtml}}
								<div class="content">
									<label>
										{{ctx.Locale.Tr "repo.projects.note.deletion_description"}}
									</label>
								</div>
								{{template "base/modal_actions_confirm" (dict "ModalButtonTypes" "confirm")}}
							</form>
						</div>
					{{end}}
				</div>
			</div>
		{{end}}
	</div>
	<div class="project-column-note-content">
		{{RenderMarkdownToHtml ctx .Content}}
	</div>
	<div class="meta">
		<span class="text light grey muted-links">
			{{$timeStr := TimeSinceUnix .CreatedUnix ctx.Locale}}
			{{ctx.Locale.Tr "repo.projects.note.created_by" $timeStr (.Creator.HomeLink | Escape) (.Creator.GetDisplayName | Escape) | Safe}}
		</span>
	</div>
	{{if .MilestoneID}}
		<div class="meta gt-my-2">
			{{RenderMilestone ctx .MilestoneID $.root.Repository.ID}}
		</div>
	{{end}}
	{{$tasks := .GetTasks}}
	{{if gt $tasks 0}}
		<div class="meta">
			{{svg "octicon-checklist" 16 "gt-mr-2 gt-vm"}}
			<span class="gt-vm">{{.GetTasksDone}} / {{$tasks}}</span>
		</div>
	{{end}}
	{{if .LabelIDs}}
		{{RenderLabelsFromIDs ctx .LabelIDs $.root.FeedURL}}
	{{end}}
</div>
{{end}}
