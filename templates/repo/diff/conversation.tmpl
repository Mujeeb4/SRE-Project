{{$resolved := (index .comments 0).IsResolved}}
{{$invalid := (index .comments 0).Invalidated}}
{{$resolveDoer := (index .comments 0).ResolveDoer}}
{{$isNotPending := (not (eq (index .comments 0).Review.Type 0))}}
{{$referenceUrl := printf "%s#%s" $.Issue.Link (index .comments 0).HashTag}}
<div class="conversation-holder" data-path="{{(index .comments 0).TreePath}}" data-side="{{if lt (index .comments 0).Line 0}}left{{else}}right{{end}}" data-idx="{{(index .comments 0).UnsignedLine}}">
	{{if or $invalid $resolved}}
		<div class="ui attached header resolved-placeholder gt-df gt-ac gt-sb">
			<div class="ui grey text">
				{{if $resolved}}
					{{svg "octicon-check" 16 "icon gt-mr-2"}}
					<b>{{$resolveDoer.Name}}</b> {{$.locale.Tr "repo.issues.review.resolved_by"}}
				{{end}}
				{{if $invalid}}
					{{if $resolved}}
						|
					{{else}}
						{{svg "octicon-alert-fill" 16 "icon gt-mr-2"}}
					{{end}}
					{{$.locale.Tr "repo.issues.review.comment_points_to_modified_line"}} <a href="{{AppSubUrl}}{{$referenceUrl}}">{{$.locale.Tr "repo.issues.review.show_original_comment"}}</a>
				{{end}}
			</div>
			<div>
				<button id="show-outdated-{{(index .comments 0).ID}}" data-comment="{{(index .comments 0).ID}}" class="{{if not $resolved}}gt-hidden {{end}}ui tiny labeled button show-outdated gt-df gt-ac">
					{{svg "octicon-unfold" 16 "gt-mr-3"}}
					{{if $resolved}}
						{{$.locale.Tr "repo.issues.review.show_resolved"}}
					{{else}}
						{{$.locale.Tr "repo.issues.review.show_outdated"}}
					{{end}}
				</button>
				<button id="hide-outdated-{{(index .comments 0).ID}}" data-comment="{{(index .comments 0).ID}}" class="{{if $resolved}}gt-hidden {{end}}ui tiny labeled button hide-outdated gt-df gt-ac">
					{{svg "octicon-fold" 16 "gt-mr-3"}}
					{{if $resolved}}
						{{$.locale.Tr "repo.issues.review.hide_resolved"}}
					{{else}}
						{{$.locale.Tr "repo.issues.review.hide_outdated"}}
					{{end}}
				</button>
			</div>
		</div>
	{{end}}
	<div id="code-comments-{{(index  .comments 0).ID}}" class="field comment-code-cloud {{if $resolved}}gt-hidden{{end}}">
		<div class="comment-list">
			<ui class="ui comments">
				{{template "repo/diff/comments" dict "root" $ "comments" .comments}}
			</ui>
		</div>
		<div class="gt-df gt-je gt-js-small gt-ac gt-fw gt-mt-3">
			<div class="ui buttons gt-mr-2">
				<button class="ui icon tiny basic button previous-conversation">
					{{svg "octicon-arrow-up" 12 "icon"}} {{$.locale.Tr "repo.issues.previous"}}
				</button>
				<button class="ui icon tiny basic button next-conversation">
					{{svg "octicon-arrow-down" 12 "icon"}} {{$.locale.Tr "repo.issues.next"}}
				</button>
			</div>
			{{if and $.CanMarkConversation $isNotPending}}
				<button class="ui icon tiny basic button resolve-conversation" data-origin="diff" data-action="{{if not $resolved}}Resolve{{else}}UnResolve{{end}}" data-comment-id="{{(index .comments 0).ID}}" data-update-url="{{$.RepoLink}}/issues/resolve_conversation">
					{{if $resolved}}
						{{$.locale.Tr "repo.issues.review.un_resolve_conversation"}}
					{{else}}
						{{$.locale.Tr "repo.issues.review.resolve_conversation"}}
					{{end}}
				</button>
			{{end}}
			{{if and $.SignedUserID (not $.Repository.IsArchived)}}
				<button class="comment-form-reply ui green tiny labeled icon button gt-ml-2 gt-mr-0">
					{{svg "octicon-reply" 16 "reply icon gt-mr-2"}}{{$.locale.Tr "repo.diff.comment.reply"}}
				</button>
			{{end}}
		</div>
		{{template "repo/diff/comment_form_datahandler" dict "hidden" true "reply" (index .comments 0).ReviewID "root" $ "comment" (index .comments 0)}}
	</div>
</div>
